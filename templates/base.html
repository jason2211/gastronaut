<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="msapplication-TileColor" content="#2b5797" />
    <meta name="theme-color" content="#ff8b3f" />

    <title>{% block title %}{% endblock %}</title>

    <link rel="manifest" href="/static/images/webmanifest.json" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/static/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/static/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/static/images/favicon-16x16.png"
    />
    <link
      rel="mask-icon"
      href="/static/images/safari-pinned-tab.svg"
      color="#ff8b3f"
    />

    <link rel="stylesheet" href="/static/css/base.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@200;300;400;900&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,600;1,300&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/css/offcanvas.css" />

    <script
      src="https://browser.sentry-cdn.com/5.19.1/bundle.min.js"
      integrity="sha384-ibWewy8LWP0FdvEBD3iLjNmbFkkh/FKtOz8GR9C8ZBWjDTbjbdIDpa4nc/AasWns"
      crossorigin="anonymous"
    ></script>
    {% if not debug %}
    <script>
      Sentry.init({
        dsn:
          'https://9d6aca2c56384459925ec4ecbf58afee@o415488.ingest.sentry.io/5306632',
      });
    </script>
    {% endif %}
    <script
      src="https://kit.fontawesome.com/5c45c2d894.js"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
      integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"
    ></script>
    <script defer src="/static/js/offcanvas.js"></script>
    <script defer src="/static/js/base.js"></script>
    {% block head %}{% endblock %}
  </head>
  <body>
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
      <a
        class="navbar-brand mr-auto mr-lg-0 fw-900 txt-orange brand-outline"
        href="/"
      >
        <i class="fas fa-user-astronaut"></i>
        Gastronaut</a
      >
      <button
        class="navbar-toggler p-0 border-0"
        type="button"
        data-toggle="offcanvas"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="navbar-collapse offcanvas-collapse"
        id="navbarsExampleDefault"
      >
        <ul class="navbar-nav mr-auto fw-200">
          {% from '/macros/nav_link.html' import nav_link_active with context %}

          <li class="nav-item {{ nav_link_active('index') }}">
            <a class="nav-link explore-nav" href="/"
              ><span class="sr-only">(current)</span>Explore</a
            >
          </li>
          <li class="nav-item {{ nav_link_active('mission_control') }}">
            <a class="nav-link" href="/mission-control">Mission Control</a>
          </li>
          <li class="nav-item {{ nav_link_active('missions') }}">
            <a class="nav-link" href="/missions">Missions</a>
          </li>
          <li class="nav-item {{ nav_link_active('mission_reports') }}">
            <a class="nav-link" { href="/reports">Mission Reports</a>
          </li>
          <li class="nav-item {{ nav_link_active('user_detail') }} dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="dropdown01"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
              >More</a
            >
            <div class="dropdown-menu" aria-labelledby="dropdown01">
              {% if g.user %}
              <a class="dropdown-item" href="/user/profile/{{g.user.id}}"
                >Profile</a
              >
              {% else %}
              <a class="dropdown-item" href="/login?next=user_detail"
                >Profile</a
              >
              {% endif %}
              <button
                class="dropdown-item preferences-btn"
                data-toggle="modal"
                data-target="#preferencesModal"
              >
                Prefrences
              </button>
              <a class="dropdown-item" href="#"
                >Gastronaut groups (Coming Soon!)</a
              >
              {% if request.endpoint == 'index' %}
              <a
                class="dropdown-item"
                href="#tips"
                data-toggle="modal"
                data-target="#tips"
              >
                Tips</a
              >
              {% endif %}
            </div>
          </li>
        </ul>
        {% if g.user %}
        <form action="/logout" method="post">
          <button class="navbar-logout mr-4 btn p-0 my-4 my-lg-0" type="submit">
            Logout
          </button>
        </form>
        {% endif %}
        <form
          class="form-inline my-2 my-lg-0 searchForm"
          action="/navbar-search"
          method="GET"
        >
          <input
            class="form-control mr-sm-2"
            type="text"
            name="q"
            placeholder="Search"
            aria-label="Search"
            {%
            if
            search_term
            %}
            value="{{search_term}}"
            {%
            endif
            %}
          />
          <input type="hidden" name="next" value="{{request.endpoint}}" />
          <input type="hidden" name="next_view_args" value="{{view_args}}" />
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">
            Search
          </button>
        </form>
      </div>
    </nav>
    <div class="navbar-traverse">
      <i class="fas fa-rocket fa-2x txt-orange brand-outline horiz-rocket"></i>
    </div>
    {% with mssgs = get_flashed_messages(with_categories=True) %} {% if mssgs %}
    {% for category, mssg in mssgs %}
    <div
      class="alert alert-sm alert-{{category}} text-center p-1 p-xl-2 mb-0 font-weight-bold"
    >
      {{mssg}}
      <span class="alert-close ml-4 text-light"
        ><i class="fas fa-window-close"></i
      ></span>
    </div>
    {% endfor %} {% endif %} {% endwith %}
    <main>
      {% block main %} {% endblock %}
    </main>

    <!-- Modal -->
    <div
      class="modal fade"
      id="preferencesModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="preferencesModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          {% if g.user %}
          <div class="modal-header">
            <h5 class="modal-title txt-orange" id="preferencesModalLabel">
              Preferences
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            {% from '/macros/preferences_check.html' import preferences_check
            with context %}

            <form id="preferences-form" action="#">
              <h5 class="txt-medium txt-white-k mb-4">
                <strong>Gastronaut Search</strong>
              </h5>
              <div class="custom-control custom-switch">
                <input
                  type="checkbox"
                  name="show_alcohol"
                  id="show_alcohol"
                  class="custom-control-input"
                  {{
                  preferences_check(g.user.preferences.show_alcohol)
                  }}
                />
                <label
                  for="show_alcohol"
                  class="custom-control-label txt-white-k txt-medium d-block"
                  >Show Alcohol
                  <small class="ml-2">(Bars, Breweries, etc.)</small></label
                >
                <small class="help-text"
                  >Takes effect on next home page load.</small
                >
              </div>
            </form>
          </div>
          <div class="modal-footer" style="position: relative;">
            <div class="feedback txt-green"></div>
            <button
              type="button"
              class="btn btn-outline-secondary txt-white-k"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
          {% else %}
          <div class="modal-header">
            <h5 class="modal-title txt-orange" id="missionsModalTitle">
              Preferences
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p class="txt-whitesmoke">
              <em>You must sign up or login to change preferences!</em>
            </p>
            <a
              class="signup btn btn-lg btn-outline-primary"
              href="/signup?next={{request.endpoint}}"
              >Sign Up</a
            >
            <span class="px-4">- OR -</span>
            <a
              class="login btn btn-lg btn-outline-primary"
              href="/login?next={{request.endpoint}}"
              >Log in</a
            >
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-secondary txt-white-k"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </body>
</html>
