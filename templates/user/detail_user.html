{% extends 'base.html' %}

<title>
  {% block title %}Gastronaut - User Profile{% endblock %}
</title>

<head>
  {% block head %}
  <meta name="description" content="Gastronaut user profile." />
  <link rel="stylesheet" href="/static/css/detail_user.css" />
  {% endblock %}
</head>

<main>
  {% block main %}
  <div
    id="main-hero"
    class=""
    style="background: url({{user.get_banner}}); background-position: center; background-size: cover;"
  ></div>
  <div class="middle-gap"></div>
  <div class="container">
    <div class="row justify-content-end">
      <div class="col-12 col-sm-3 avatar-col text-center">
        <div
          style="background: url('{{ user.get_avatar }}'); background-position: center;
              background-size: cover;"
          id="profile-avatar"
        ></div>
        <div class="">
          <h4
            id="sidebar-username"
            class="txt-orange brand-outline font-italic"
          >
            @{{ user.username }}
          </h4>
          <p class="txt-green byline pl-3 pl-sm-0">{{user.byline}}</p>
          {% if user.city or user.state or user.country %}
          <div class="user-location text-left d-inline-block">
            <div class="fa fa-map-marker fa-2x txt-green d-inline-block"></div>
            <div class="location text-dark d-inline-block">
              {{user.city}}, {{user.state}}
            </div>
            <br />
            <div class="location text-dark">{{user.country}}</div>
          </div>
          {% endif %}
        </div>
      </div>
      <div class="col-12 col-sm-9 text-right">
        <ul class="user-stats nav nav-pills">
          <li class="stat">
            <p class="small txt-white-k">Missions Created</p>
            <h4>
              {% if g.user == user %}
              <a href="/mission-control">{{ user.my_missions | length }}</a>
              {% else %}
              <span class="text-primary">{{ user.my_missions | length }}</span>
              {% endif %}
            </h4>
          </li>
          <li class="stat">
            <p class="small txt-white-k">Missions Total</p>
            <h4>
              {% if g.user == user %}
              <a href="/mission-control">{{ user.missions | length }}</a>
              {% else %}
              <span class="text-primary">{{ user.missions | length }}</span>
              {% endif %}
            </h4>
          </li>
          <li class="stat">
            <p class="small txt-white-k">Reports</p>
            <h4>
              <span class="text-primary">{{ user.reports | length }}</span>
            </h4>
          </li>
          <li class="stat">
            <p class="small txt-white-k">Gastronaut Groups</p>
            <h4>
              <span class="text-primary">0</span>
            </h4>
          </li>
          <li class="li-edit ml-0 ml-md-3 ml-lg-5 mb-2 mb-md-0">
            {% if g.user.id == user.id %}
            <a
              href="/user/edit"
              class="btn btn-outline-primary mt-1 mt-sm-3 mt-md-0 rounded-pill"
              >Edit Profile</a
            >
            {% endif %}
          </li>
        </ul>
        <div class="col col-lg-9">
          <section class="bio-section text-left mt-3 mt-md-5 txt-white-k">
            {% if user.bio %} {% for p in user.bio.split('\n') %}
            <p>{{p}}</p>
            {% endfor %} {% endif %}
          </section>
        </div>
      </div>
    </div>
    <div class="row mb-5">
      <div class="col-12 col-sm-3 px-5 p-sm-0 mt-3 mb-4">
        <div
          class="nav flex-column nav-pills"
          id="pills-tab"
          role="tablist"
          aria-orientation="vertical"
        >
          <a
            class="nav-link active museo txt-lg"
            id="pills-missions-tab"
            data-toggle="pill"
            href="#missions-tab"
            role="tab"
            aria-controls="missions-tab"
            aria-selected="true"
          >
            <div class="no-wrap">
              Missions {% if missions %}<i
                class="far fa-check-square fa-xs ml-2"
              ></i
              >{% endif %}
            </div>
          </a>
          <a
            class="nav-link museo txt-lg"
            id="pills-reports-tab"
            data-toggle="pill"
            href="#reports-tab"
            role="tab"
            aria-controls="reports-tab"
            aria-selected="false"
            >Mission
            <div class="d-inline-block">
              Reports {% if user.reports %}<i
                class="far fa-check-square fa-xs ml-2"
              ></i
              >{% endif %}
            </div>
          </a>
        </div>
      </div>

      <div class="col-12 col-sm-9">
        <div class="tab-content" id="pills-tabContent">
          <div
            class="tab-pane fade show active"
            id="missions-tab"
            role="tabpanel"
            aria-labelledby="missions-tab"
          >
            <section
              class="missions-section text-center txt-white-k card-columns"
            >
              {% if missions %} {% for mission in missions %}
              <div class="card d-inline-block m-2 text-left">
                <div class="card-body">
                  <h5 class="card-title font-weight-bold">{{mission.name}}</h5>
                  <br />
                  <p class="card-text txt-orange">
                    <em>{{mission.description}}</em>
                  </p>
                </div>
                <ul class="list-group list-group-flush">
                  {% for business in mission.businesses %}
                  <li class="list-group-item">{{business.name}}</li>
                  {% endfor %}
                </ul>
                <div class="card-footer">
                  <a href="#" class="card-link"
                    ><i class="far fa-thumbs-up fa-lg"></i
                  ></a>
                  <span class="px-3 text-dark">
                    {{mission.likes}}
                  </span>
                  <a href="#" class="float-right card-link ml-3"
                    >Add to Missions</a
                  >
                </div>
              </div>
              {% endfor %} {% endif %}
            </section>
          </div>
          <div
            class="tab-pane fade"
            id="reports-tab"
            role="tabpanel"
            aria-labelledby="reports-tab"
          >
            <section
              class="missions-section text-center txt-white-k card-columns"
            >
              {% if user.reports %} {% for report in user.reports %}
              <div class="card card-norm d-inline-block m-2 text-left">
                <div class="card-header">
                  {% if report.business_id %}
                  <h5 class="card-title font-weight-bold">
                    {{report.business.name}}
                  </h5>
                  <h5 class="lead"><small>Business</small></h5>
                  {% else %}
                  <h5 class="card-title txt-info">{{report.mission.name}}</h5>
                  <h5 class="lead"><small>Mission</small></h5>
                  {% endif %}
                  <div class="card-text">
                    <a href="/user/profile/{{report.user.id}}">
                      <em class="txt-orange"> by @{{report.user.username}}</em>
                    </a>
                    <div class="txt-smlr">
                      {{report.submitted_on.strftime('%a %b %w, %Y')}}
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  {% if report.text[500:] %} {% set text = report.text[:500] +
                  '...' %} {% else %} {% set text = report.text[:500] %} {%
                  endif %} {% for p in text.split('\n') %}
                  <p>{{p}}</p>
                  {%- endfor %}
                </div>
                <div class="card-footer">
                  <a href="#" class="card-link"
                    ><i class="far fa-thumbs-up fa-lg"></i
                  ></a>
                  <span class="px-3 text-dark">
                    {{report.likes}}
                  </span>
                  <a href="/reports/{{report.id}}" class="card-link float-right"
                    >Read More</a
                  >
                </div>
              </div>
              {% endfor %} {% endif %}
            </section>
          </div>
        </div>
      </div>
      <!-- </div> -->
    </div>
  </div>
  {% endblock %}
</main>
