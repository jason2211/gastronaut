{% extends 'base.html' %} {% from 'macros/select_active_sort.html' import
select_sort with context %}

<title>
  {% block title %}Gastronaut - Missions{% endblock %}
</title>

<head>
  {% block head %}
  <meta
    name="description"
    content="Explore gastronomical missions. Users create and share themed missions of local flavor to experience. Check it out!"
  />
  <link rel="stylesheet" href="/static/css/reports.css" />
  <script defer src="/static/js/likes.js"></script>
  {% endblock %}
</head>

<main>
  {% block main %}
  <div id="main-hero" class="flx-std">
    <h1 class="display-1-k museo orange-outline">Explore Missions</h1>
  </div>
  <div class="middle-gap py-3 px-5 py-sm-1 p-lg-0">
    <form
      action="/missions"
      method="GET"
      class="form-inline filter-form flx-std"
    >
      <label for="sortby" class="sr-only">Sort By</label>
      <select
        class="custom-select custom-select-sm mx-1 mr-sm-1 mr-md-3 mr-lg-4 mb-1 my-sm-1"
        id="sortby"
        name="sort_by"
      >
        <option value="recent" {{ select_sort('recent') }}>Most Recent</option>
        <option value="oldest" {{ select_sort('oldest') }}>Oldest</option>
        <option value="likes" {{ select_sort('likes') }}>Most Likes</option>
      </select>

      <label for="city" class="sr-only">City</label>
      <input
        type="text"
        class="form-control form-control-sm mx-1 mr-sm-1 mr-md-2 mb-1 my-sm-1"
        placeholder="City"
        name="city"
        maxlength="55"
        value="{{form_data.get('city', '')}}"
      />
      <label for="search-term" class="sr-only">State</label>
      <input
        type="text"
        class="form-control form-control-sm mx-1 mr-sm-1 mr-md-2 mb-1 my-sm-1"
        placeholder="State"
        name="state"
        pattern="^[A-Za-z]{2}$"
        maxlength="2"
        value="{{form_data.get('state', '')}}"
      />
      <label for="search-term" class="sr-only">Country</label>
      <input
        type="text"
        class="form-control form-control-sm mx-1 mr-sm-1 mr-md-3 mr-lg-4 mb-1 my-sm-1"
        placeholder="Country"
        name="country"
        maxlength="2"
        value="{{form_data.get('country', '')}}"
      />
      <label for="search-term" class="sr-only">Keywords</label>
      <input
        type="text"
        class="form-control form-control-sm mx-1 mb-1 my-sm-1"
        placeholder="Keywords"
        name="keywords"
        value="{{form_data.get('keywords', '')}}"
      />
      <button
        type="submit"
        class="btn btn-sm btn-outline-success ml-sm-3 ml-lg-4 mt-2 mt-sm-0"
      >
        Search
      </button>
    </form>
  </div>
  <div class="container">
    <div class="row mb-5">
      <div class="col-12">
        <section class="text-center mt-md-1 mt-lg-5 txt-white-k card-columns">
          {% for mission in missions %}
          <div class="card d-inline-block m-2 text-left">
            <div class="card-body">
              <h5 class="card-title font-weight-bold">{{mission.name}}</h5>
              <div class="card-text">
                <a href="/user/profile/{{mission.user.id}}">
                  <em class="txt-orange"> by @{{mission.user.username}}</em>
                </a>
                <div class="txt-smlr">
                  {{mission.date_shared.strftime('%a %b %w, %Y')}}
                </div>
              </div>
              <br />
              <p class="card-text text-success font-weight-bold">
                <em>{{mission.description}}</em>
              </p>
            </div>
            <ul class="list-group list-group-flush">
              {% for business in mission.businesses %}
              <li class="list-group-item">{{business.name}}</li>
              {% endfor %}
            </ul>
            <div class="card-footer">
              {% if not g.user %}
              <button
                type="button"
                class="like-button text-primary"
                data-toggle="modal"
                data-target="#signupModal"
              >
                <i class="far fa-thumbs-up fa-lg"></i>
              </button>
              {% elif mission.editor == g.user.id %}
              <i class="fas fa-thumbs-up fa-lg text-primary"></i>
              {% else %}
              <a
                href="#"
                class="card-link like-mission"
                data-mission_id="{{mission.id}}"
              >
                <span class="">
                  {% if g.user.id in mission.likes %}
                  <i class="fas fa-thumbs-up fa-lg"></i>
                  <i class="far fa-thumbs-up fa-lg" style="display: none;"></i>
                  {% else %}
                  <i class="far fa-thumbs-up fa-lg"></i>
                  <i class="fas fa-thumbs-up fa-lg" style="display: none;"></i>
                  {% endif %}
                </span>
              </a>
              {% endif %}
              <span class="px-3 text-dark likes">
                {{mission.likes | length}}
              </span>
              <a href="#" class="float-right card-link ml-3">Add to Missions</a>
            </div>
          </div>
          {% endfor %}
        </section>
      </div>
    </div>
  </div>
  {% include 'include/include_signup_login_modal.html' with context %} {%
  endblock %}
</main>
